apiVersion: v1
kind: Namespace
metadata:
  name: openebs-nfs
  labels:
    pod-security.kubernetes.io/enforce: privileged
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: openebs-nfs
  namespace: openebs-nfs
spec:
  interval: 1m
  url: https://openebs-archive.github.io/dynamic-nfs-provisioner
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: nfs
  namespace: openebs-nfs
spec:
  releaseName: openebs-nfs
  chart:
    spec:
      chart: openebs
      sourceRef:
        kind: HelmRepository
        name: openebs-nfs
        namespace: openebs-nfs
      version: "*"
  interval: 1m
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    ndm:
      enabled: false
    ndmOperator:
      enabled: false
    localprovisioner:
      enabled: false
    nfs-provisioner:
      enabled: true
    nfsStorageClass:
      backendStorageClass: "openebs-single-replica-ssd"
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: openebs-single-replica-ssd-rwx
  annotations:
    openebs.io/cas-type: nfsrwx
    cas.openebs.io/config: |
      - name: NFSServerType
        value: "kernel"
        # value: "kernel"
      - name: BackendStorageClass
        value: "openebs-single-replica-ssd"
      # LeaseTime defines the renewal period(in seconds) for client state
      #- name: LeaseTime
      #  value: 30
      # GraceTime defines the recovery period(in seconds) to reclaim locks
      #- name: GraceTime
      #  value: 30
      # FilePermissions defines the file ownership and mode specifications
      # for the NFS server's shared filesystem volume.
      # File permission changes are applied recursively if the root of the
      # volume's filesystem does not match the specified value.
      # Volume-specific file permission configuration can be specified by
      # using the FilePermissions config key in the PVC YAML, instead of
      # the StorageClass's.
      #- name: FilePermissions
      #  data:
      #    UID: "1000"
      #    GID: "2000"
      #    mode: "0755"
allowVolumeExpansion: true
provisioner: openebs.io/nfsrwx
reclaimPolicy: Delete
